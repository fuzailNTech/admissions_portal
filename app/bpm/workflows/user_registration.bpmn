<?xml version='1.0' encoding='UTF-8'?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:app="urn:yourapp:ext" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI">
  <bpmn:process id="Parent" isExecutable="true">
    <bpmn:callActivity id="CA_Verify" name="Verify Documents" calledElement="docs.verify_bundle@v7">
      <bpmn:extensionElements>
        <app:params>{"vendor": "VeroDocs", "sla_hours": 24}</app:params>
        <app:inputMap>{"documents": "$.application.documents"}</app:inputMap>
        <app:outputMap>{"$.application.verification": "$out"}</app:outputMap>
      </bpmn:extensionElements>
    </bpmn:callActivity>
    <bpmn:exclusiveGateway id="GW_ReviewDecision" default="F__5"/>
    <bpmn:callActivity id="CA_FacultyReview" name="Faculty Review" calledElement="review.faculty_panel@v2">
      <bpmn:extensionElements>
        <app:params>{"committee": "Admissions", "min_score": 70}</app:params>
        <app:inputMap>{}</app:inputMap>
        <app:outputMap>{}</app:outputMap>
      </bpmn:extensionElements>
    </bpmn:callActivity>
    <bpmn:callActivity id="CA_Shortlist" name="Shortlist Interview" calledElement="review.shortlist_interview@v1">
      <bpmn:extensionElements>
        <app:params>{"panel": "Light"}</app:params>
        <app:inputMap>{}</app:inputMap>
        <app:outputMap>{}</app:outputMap>
      </bpmn:extensionElements>
    </bpmn:callActivity>
    <bpmn:callActivity id="CA_Fee" name="Collect Fee" calledElement="payments.collect_fee@v4">
      <bpmn:extensionElements>
        <app:params>{"currency": "PKR", "amount_source": "fixed", "fixed_amount": 5000, "due_in_hours": 48}</app:params>
        <app:inputMap>{"applicantId": "$.applicant.id", "programId": "$.program.id"}</app:inputMap>
        <app:outputMap>{"$.payments.application_fee": "$out"}</app:outputMap>
      </bpmn:extensionElements>
    </bpmn:callActivity>
    <bpmn:startEvent id="Start"/>
    <bpmn:sequenceFlow id="F_START" sourceRef="Start" targetRef="CA_Verify"/>
    <bpmn:endEvent id="End__CA_Fee"/>
    <bpmn:sequenceFlow id="F__1" sourceRef="CA_Verify" targetRef="GW_ReviewDecision"/>
    <bpmn:sequenceFlow id="F__2" sourceRef="CA_FacultyReview" targetRef="CA_Fee"/>
    <bpmn:sequenceFlow id="F__3" sourceRef="CA_Shortlist" targetRef="CA_Fee"/>
    <bpmn:sequenceFlow id="F__4" sourceRef="GW_ReviewDecision" targetRef="CA_FacultyReview">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${json_logic('{"and": [{"&gt;=": ["$.gpa", 3.0]}, {"&gt;=": ["$.testScore", 70]}]}')}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="F__5" sourceRef="GW_ReviewDecision" targetRef="CA_Shortlist"/>
    <bpmn:sequenceFlow id="F__END__CA_Fee" sourceRef="CA_Fee" targetRef="End__CA_Fee"/>
  </bpmn:process>
  <bpmndi:BPMNDiagram>
    <bpmndi:BPMNPlane bpmnElement="Parent">
      <bpmndi:BPMNShape bpmnElement="CA_Verify">
        <dc:Bounds x="350" y="260" width="160" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="GW_ReviewDecision">
        <dc:Bounds x="600" y="260" width="50" height="50"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="CA_FacultyReview">
        <dc:Bounds x="850" y="260" width="160" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="CA_Shortlist">
        <dc:Bounds x="850" y="120" width="160" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="CA_Fee">
        <dc:Bounds x="1100" y="260" width="160" height="80"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Start">
        <dc:Bounds x="100" y="260" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="End__CA_Fee">
        <dc:Bounds x="1350" y="260" width="36" height="36"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="F_START">
        <di:waypoint x="118.0" y="278.0"/>
        <di:waypoint x="274.0" y="278.0"/>
        <di:waypoint x="430.0" y="300.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__1">
        <di:waypoint x="430.0" y="300.0"/>
        <di:waypoint x="527.5" y="300.0"/>
        <di:waypoint x="625.0" y="285.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__2">
        <di:waypoint x="930.0" y="300.0"/>
        <di:waypoint x="1055.0" y="300.0"/>
        <di:waypoint x="1180.0" y="300.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__3">
        <di:waypoint x="930.0" y="160.0"/>
        <di:waypoint x="1055.0" y="160.0"/>
        <di:waypoint x="1180.0" y="300.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__4">
        <di:waypoint x="625.0" y="285.0"/>
        <di:waypoint x="777.5" y="285.0"/>
        <di:waypoint x="930.0" y="300.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__5">
        <di:waypoint x="625.0" y="285.0"/>
        <di:waypoint x="777.5" y="285.0"/>
        <di:waypoint x="930.0" y="160.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="F__END__CA_Fee">
        <di:waypoint x="1180.0" y="300.0"/>
        <di:waypoint x="1274.0" y="300.0"/>
        <di:waypoint x="1368.0" y="278.0"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>